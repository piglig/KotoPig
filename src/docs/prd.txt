<context>
# Overview  
KotoPig v2 是一款专注于日语词汇记忆与复习的交互式学习平台，本次重构旨在提升系统的可维护性、性能与视觉美感，简化功能逻辑并强化用户互动体验。  
我们将核心功能模块化，实现组件复用与逻辑解耦，增强未来扩展能力。前端将引入更加现代化的 UI 框架与动画交互方案，提升学习愉悦感。

# Key Redesign Goals  
🔧 架构重构：组件/模块粒度更细，支持按需加载和功能解耦；  
🎨 视觉焕新：更具美感的 UI（使用 MUI），动画反馈更自然；  
📊 数据结构优化：词汇/复习/成就数据结构重整，减少冗余；  
🚀 性能优化：前端 SSR 支持、更快响应、静态词典预加载；  
🔄 用户体验增强：新用户引导、沉浸式复习体验、精细化统计反馈。
</context>

<PRD>
# Reimagined Core Features  
1. 🔍 **词汇检索与展示**  
   - 全文模糊检索支持（假名/汉字/罗马音/英文）  
   - 展示动词五段活用图，支持交互式展示（鼠标悬浮解释）  
   - “添加到我的词表”一键操作  

2. 🗓️ **智能复习系统**  
   - 基于艾宾浩斯曲线动态生成待复习列表  
   - 支持词频优先、错误优先排序  
   - 提供“今日已完成”图标反馈与打卡动画  

3. 🃏 **闪卡模式（全新 UI）**  
   - 支持图片/例句/发音扩展  
   - 支持手势操作（滑动记忆/打标签/生词本）  
   - 添加“收藏夹”与“难词列表”  

4. 🔊 **多模态词汇展示**  
   - 每个词条配备动态假名拼音显示  
   - 标准 TTS 发音（慢速/重复）  
   - 示例句子高亮词汇、语法分类、变形按钮一键跳转  

5. 📈 **学习统计与视觉反馈**  
   - 日历式复习完成视图、高亮连续打卡记录  
   - 支持词汇掌握度图、难词分析图  
   - 导出学习报告  

6. 🏅 **成就与激励系统**  
   - 用户等级 + 成长值机制  
   - 解锁主题/称号/头像边框  
   - 微交互式展示徽章收集动画  

7. 🧠 **动词活用训练（模块化）**  
   - 自动生成练习题（文本 + 选择 + 拼写）  
   - 来源支持：错题本 / 随机库 / 指定词表  
   - 即时评分，提供变形规则讲解  

# Technical Architecture  
📦 **技术栈**  
- 前端：React + MUI + Framer Motion  
- 后端：Supabase（鉴权+数据）或 Flask API  
- 数据库：PostgreSQL + Supabase Edge Functions  
- 动画支持：Lottie + Framer Motion  
- 发音：Web Speech API + 可选 MP3 本地缓存  

🗃️ **核心数据模型**  
| Model      | Fields                                                                 |
|------------|------------------------------------------------------------------------|
| User       | id, username, email, avatar, level, streak, badges                    |
| Word       | word_id, kana, kanji, meaning, pos, forms[], audio, example_sentences |
| Review     | user_id, word_id, next_review_time, review_count, last_result         |
| Badge      | badge_id, title, unlock_condition, icon                               |
| Stats      | user_id, date, learned_words, review_success, streak                  |
| Flashcard  | user_id, word_id, tag, status                                         |

# UI/UX 设计目标  
✅ 使用 MUI 提供可定制组件  
🎨 暗色模式 + 响应式优先，适配移动端学习场景  
🌀 动态词云/首页动画（Lottie）提升吸引力  
🌍 支持多语言切换（中/日/英）  
🎯 动画引导式初次用户上手流程（Onboarding）

# Rebuild Roadmap  
| 阶段 | 功能模块              | 简要说明                                  |
|------|-----------------------|-------------------------------------------|
| v1   | 词汇查询 + 发音       | 基于本地词库/静态数据集，搜索展示 UI 重构 |
| v1   | 用户系统 + 登录       | 使用 Supabase 鉴权                         |
| v1   | 打卡功能 + 徽章       | 基本打卡统计与徽章条件                    |
| v1   | 闪卡练习              | 新 UI + 动画反馈                          |
| v1   | 首页词云展示          | 热门词云、动态渲染                        |
| v2   | 动词变形题目模块      | 数据生成引擎，评分与讲解                  |
| v2   | 学习统计图表          | ECharts + 用户每日数据                    |
| v2   | 用户词表（收藏/错词） | 支持导出、自定义列表                      |
| v3+  | AI推荐系统            | 词汇优先级排序、记忆路径生成              |
| v3+  | 打卡社区              | 社交鼓励、PK 模式、好友组队               |

# 风险与应对策略  
| 风险                     | 应对措施                                                        |
|--------------------------|-----------------------------------------------------------------|
| 动词变形规则实现复杂     | 初期使用模板 + 显示规则；中后期构建规则生成引擎               |
| 动画/视觉资源产出成本高 | 使用 Lottie + 开源动画资源 + 组件级复用                        |
| 初期功能过重影响上线周期 | MVP 分阶段推进，v1 只实现核心学习流程                          |
| 数据量增大导致加载变慢   | 数据分页 / 动态加载 / SWR 本地缓存策略                         |

# 参考资源与设计灵感  
- **MUI**（现代美学组件库）  
- **Duolingo**（学习交互与成就系统）  
- **Jisho.org**（词汇查找交互参考）  
- **LottieFiles**（动画素材）  
- **Anki**（卡片复习模型）
</PRD>